<app-generic-list-card
  [title]="'Unidades Organizativas'"
  [buttonSave]="true"
  [dataSourceInput]="listUnits"
  [pageSize]="9"
  [customTemplates]="{
    'meta': metaTpl,
    'actions': actionsTpl
  }"
  (onCreate)="create()"
  (onView)="view($event)"
  (onEdit)="edit($event)"
  (onDelete)="remove($event)"
  (onToggleStatus)="toggle($event)">
</app-generic-list-card>

<!-- Meta personalizada: divisiones | sucursales -->
<ng-template #metaTpl let-e>
  <span>{{ e.subtitle }}</span>
</ng-template>

<!-- Acciones personalizadas -->
<ng-template #actionsTpl let-e>
  <div class="action-buttons">
    <button mat-raised-button color="primary" (click)="view(e)">
      <mat-icon>visibility</mat-icon>
      Ver Detalle
    </button>

    <button mat-raised-button color="accent" (click)="edit(e)">
      <mat-icon>edit</mat-icon>
      Editar
    </button>

    <button mat-raised-button color="warn" (click)="remove(e)">
      <mat-icon>delete</mat-icon>
      Eliminar
    </button>
  </div>
</ng-template>

<!-- Dialog Template for Create Form -->
<ng-template #createFormDialog>
  <h2 mat-dialog-title>Crear Unidad Organizativa</h2>
  <mat-dialog-content>
    <form [formGroup]="organizationalUnitForm" class="form-container">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nombre</mat-label>
        <input matInput formControlName="name" required>
        <mat-error *ngIf="organizationalUnitForm.get('name')?.invalid && organizationalUnitForm.get('name')?.touched">
          Nombre es requerido
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Descripci贸n</mat-label>
        <textarea matInput formControlName="description" required></textarea>
        <mat-error *ngIf="organizationalUnitForm.get('description')?.invalid && organizationalUnitForm.get('description')?.touched">
          Descripci贸n es requerida
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>C贸digo</mat-label>
        <input matInput formControlName="code" required>
        <mat-error *ngIf="organizationalUnitForm.get('code')?.invalid && organizationalUnitForm.get('code')?.touched">
          C贸digo es requerido
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Sedes</mat-label>
        <mat-select formControlName="branchIds" multiple required>
          <mat-option *ngFor="let branch of branches" [value]="branch.id">
            {{ branch.name }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="organizationalUnitForm.get('branchIds')?.invalid && organizationalUnitForm.get('branchIds')?.touched">
          Seleccionar al menos una sede
        </mat-error>
      </mat-form-field>
    </form>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Cancelar</button>
    <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="organizationalUnitForm.invalid">Crear</button>
  </mat-dialog-actions>
</ng-template>
