<div class="container">
  <div class="header-section">
    <h2>{{ isEdit ? 'Editar Evento' : 'Crear Evento' }}</h2>
    <p class="header-description">Complete la información necesaria para {{ isEdit ? 'actualizar' : 'crear' }} su evento</p>
  </div>

  <!-- Progress Bar -->
  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="progressPercentage"></div>
    </div>
    <div class="progress-steps">
      <span class="step" [class.active]="currentStep >= 1">1</span>
      <span class="step" [class.active]="currentStep >= 2">2</span>
      <span class="step" [class.active]="currentStep >= 3">3</span>
      <span class="step" [class.active]="currentStep >= 4">4</span>
    </div>
  </div>

  <form [formGroup]="eventForm" (ngSubmit)="onSubmit()" class="event-form">
    <div class="main-layout">
      <!-- Columna Izquierda -->
      <div class="left-column">

        <!-- Información del evento -->
        <div class="info-card">
          <div class="card-header">
            <mat-icon class="card-icon">event</mat-icon>
            <h3 class="card-title">Información del evento</h3>
          </div>

          <div class="form-row">
            <div class="form-group">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Nombre del Evento</mat-label>
                <input matInput formControlName="name" placeholder="Enter event name">
              </mat-form-field>
            </div>

            <div class="form-group">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Descripción del Evento</mat-label>
                <textarea matInput formControlName="description" rows="3" placeholder="Describe tu evento"></textarea>
              </mat-form-field>
            </div>
          </div>

          <!-- En la sección "Información del evento", después del campo Descripción -->
          <div class="form-row">
            <div class="form-group ">
              <mat-form-field appearance="outline" class="full-width-espacio">
                <mat-label>Tipo de Evento</mat-label>
                <mat-select formControlName="eventTypeId" required>
                  <mat-option *ngFor="let type of eventTypeOptions" [value]="type.id">
                    {{ type.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <mat-form-field appearance="outline" class="full-width-espacio">
                <mat-label>Fecha de inicio</mat-label>
                <input matInput [matDatepicker]="startDatePicker" formControlName="scheduleDate"
                  placeholder="MM / DD / YYYY">
                <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #startDatePicker></mat-datepicker>
              </mat-form-field>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <mat-form-field appearance="outline" class="full-width-espacio">
                <mat-label>Fecha de finalización</mat-label>
                <input matInput [matDatepicker]="endDatePicker" formControlName="endDate"
                  placeholder="MM / DD / YYYY">
                <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #endDatePicker></mat-datepicker>
              </mat-form-field>
            </div>
          </div>



          <!-- <mat-form-field>
            <mat-label>Toppings</mat-label>
            <mat-select multiple>
              <mat-option *ngFor="let topping of toppingList" [value]="topping.name">
                <div class="option-content">
                  <span class="option-title">{{ topping.name }}</span>
                  <small class="option-description">{{ topping.description }}</small>
                </div>
              </mat-option>
            </mat-select>
          </mat-form-field> -->


          <div class="form-row">
            <div class="form-group toggle-group">
              <div class="toggle-field">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Seleccione Jornadas</mat-label>
                  <mat-select formControlName="schedules" multiple required>
                    <mat-option *ngFor="let s of listSchedule" [value]="s">
                      {{ s.name }} ({{ s.startTime }} - {{ s.endTime }})
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <button mat-stroked-button color="primary" type="button" (click)="openModal()">
                  <span class="material-icons">add</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Acceso al Evento -->
        <div class="access-card">
          <div class="card-header">
            <mat-icon class="card-icon">security</mat-icon>
            <h3 class="card-title">Acceso al Evento</h3>
          </div>

          <div class="access-options">
            <mat-radio-group formControlName="accessType" class="access-radio-group">
              <div class="access-radio-option" [class.selected]="eventForm.get('accessType')?.value === 'public'">
                <mat-radio-button value="public">
                  <div class="access-content">
                    <div class="access-title">
                      <mat-icon class="access-icon">public</mat-icon>
                      Todo al público
                    </div>
                    <div class="access-description">Cualquier persona puede acceder al evento</div>
                  </div>
                </mat-radio-button>
              </div>

              <div class="access-radio-option" [class.selected]="eventForm.get('accessType')?.value === 'private'">
                <mat-radio-button value="private">
                  <div class="access-content">
                    <div class="access-title">
                      <mat-icon class="access-icon">lock</mat-icon>
                      Acceso privado
                    </div>
                    <div class="access-description">Solo personas autorizadas pueden acceder</div>
                  </div>
                </mat-radio-button>
              </div>
            </mat-radio-group>
          </div>
        </div>

        <!-- Filtros Avanzados -->
        <div class="filters-card">
          <div class="card-header">
            <mat-icon class="card-icon">filter_list</mat-icon>
            <h3 class="card-title">Filtros Avanzados</h3>
          </div>


          <div class="form-row">
            <div class="form-group">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Perfiles</mat-label>
                <mat-select formControlName="profiles" multiple placeholder="Seleccionar perfil">
                  <mat-option *ngFor="let profile of profilesOptions" [value]="profile.id">
                    {{ profile.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-group">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Unidades Organizativas</mat-label>
                <mat-select formControlName="organizationalUnits" multiple placeholder="Seleccionar unidades">
                  <mat-option *ngFor="let unit of organizationalUnitOptions" [value]="unit.id">
                    {{ unit.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Divisiones</mat-label>
                <mat-select formControlName="divisions" multiple placeholder="Seleccionar divisiones">
                  <mat-option *ngFor="let division of internalDivisionOptions" [value]="division.id">
                    {{ division.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-group">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Código</mat-label>
                <input matInput formControlName="code" placeholder="Código (auto si vacío)">
              </mat-form-field>
            </div>
          </div>

          <!-- Campos ocultos para mantener compatibilidad -->
          <!-- <div style="display: none;">
            <mat-form-field>
              <input matInput formControlName="eventTypeId" [value]="1">
            </mat-form-field>
            <mat-form-field>
              <input matInput formControlName="scheduleId" [value]="1">
            </mat-form-field>
          </div> -->
        </div>

        <!-- Supervisores -->
        <div class="supervisors-card">
          <div class="card-header">
            <mat-icon class="card-icon">supervisor_account</mat-icon>
            <h3 class="card-title">Supervisores del Evento</h3>
          </div>

          <div class="supervisors-content">
            <!-- Botón para agregar supervisor -->
            <button mat-raised-button color="primary" type="button" (click)="assignSupervisor()" class="add-supervisor-btn">
              <mat-icon>person_add</mat-icon>
              Asignar Supervisor
            </button>

            <!-- Lista de supervisores asignados -->
            <div class="supervisors-list" *ngIf="selectedSupervisors.length > 0">
              <div class="supervisor-item" *ngFor="let supervisor of selectedSupervisors; let i = index">
                <div class="supervisor-info">
                  <div class="supervisor-name">
                    {{ supervisor.firstName }} {{ supervisor.lastName }}
                  </div>
                  <div class="supervisor-details">
                    <span class="detail">
                      <mat-icon>badge</mat-icon>
                      {{ supervisor.documentNumber }}
                    </span>
                    <span class="detail">
                      <mat-icon>email</mat-icon>
                      {{ supervisor.email }}
                    </span>
                  </div>
                </div>
                <button mat-icon-button color="warn" type="button" (click)="removeSupervisor(i)" matTooltip="Remover supervisor">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>

            <!-- Estado vacío -->
            <div class="empty-supervisors" *ngIf="selectedSupervisors.length === 0">
              <mat-icon class="empty-icon">supervisor_account</mat-icon>
              <p>No hay supervisores asignados</p>
              <p class="empty-description">Asigna supervisores para tu evento</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Columna Derecha -->
      <div class="right-column">
        <!-- Puntos de Acceso -->
        <div class="access-points-card">
          <div class="access-points-header">
            <div class="card-header">
              <mat-icon class="card-icon">location_on</mat-icon>
              <h3 class="card-title">Puntos de Acceso</h3>
            </div>
            <button mat-raised-button color="primary" class="add-btn" type="button" (click)="openAddAccessPointDialog()">
      <mat-icon>add</mat-icon> Agregar  
            </button>
          </div>

          <!-- Lista de puntos de acceso seleccionados -->
          <div formArrayName="accessPoints">
            <div class="access-points-table" *ngIf="accessPointsArray.length > 0">
              <div class="table-header">
                <span class="header-cell">NOMBRE</span>
                <span class="header-cell">TIPO</span>
                <span class="header-cell">ACCIONES</span>
              </div>
              <div class="table-body">
                <div *ngFor="let apControl of accessPointsArray.controls; let i = index" [formGroupName]="i" class="table-row">
                  <span class="table-cell">{{ apControl.get('name')?.value }}</span>
                  <span class="table-cell type-cell">{{ getAccessPointTypeName(apControl.get('typeId')?.value) }}</span>
                  <span class="action-cell">
                    <button mat-button class="delete-btn" type="button" (click)="deleteAccessPoint(i)">Delete</button>
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- Estado vacío -->
          <div class="empty-state" *ngIf="accessPointsArray.length === 0">
            <mat-icon class="empty-icon">location_on</mat-icon>
            <p>No hay puntos de acceso agregados</p>
            <p class="empty-description">Agrega puntos de acceso para tu evento</p>
          </div>

          <!-- Mini-form para agregar AP (oculto por defecto) -->
          <div class="ap-mini-form" *ngIf="showAddForm">
            <div class="form-row">
              <div class="form-group">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Nombre del Punto</mat-label>
                  <input matInput formControlName="apName" placeholder="Entrada Norte">
                </mat-form-field>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Tipo de Punto de Acceso</mat-label>
                  <mat-select formControlName="typeId">
                    <mat-option [value]="1">Entrada</mat-option>
                    <mat-option [value]="2">Salida</mat-option>
                    <mat-option [value]="3">Mixto</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Descripción</mat-label>
                  <input matInput formControlName="apDescription" placeholder="Puerta principal">
                </mat-form-field>
              </div>
            </div>

            <div class="form-actions-mini">
              <button mat-button type="button" (click)="cancelAddAccessPoint()">Cancelar</button>
              <button mat-raised-button color="primary" type="button" (click)="addAccessPointManual()">
                Agregar punto
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Botón crear/actualizar evento -->
    <div class="form-actions">
      <button mat-stroked-button color="accent" type="button" class="back-btn" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        Volver a la lista
      </button>
      <button mat-raised-button color="primary" type="submit" class="create-btn">
        <mat-icon>{{ isEdit ? 'update' : 'add_circle' }}</mat-icon>
        {{ isEdit ? 'Actualizar Evento' : 'Crear Evento' }}
      </button>
    </div>

  
  </form>
</div>