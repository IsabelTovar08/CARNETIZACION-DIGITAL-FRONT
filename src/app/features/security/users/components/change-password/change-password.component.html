<h2 mat-dialog-title>Cambiar contraseña</h2>

<mat-dialog-content [formGroup]="passwordForm" class="dialog-content">
  
  <!-- Contraseña actual -->
  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Contraseña actual</mat-label>
    <input matInput 
           [type]="showCurrentPassword ? 'text' : 'password'" 
           formControlName="currentPassword"
           [class.error]="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
    <button mat-icon-button 
            matSuffix 
            type="button" 
            (click)="togglePasswordVisibility('current')"
            [attr.aria-label]="'Hide password'" 
            [attr.aria-pressed]="showCurrentPassword">
      <mat-icon>{{ showCurrentPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
    </button>
    <mat-error *ngIf="getFieldError('currentPassword')">
      {{ getFieldError('currentPassword') }}
    </mat-error>
  </mat-form-field>

  <!-- Nueva contraseña -->
  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Nueva contraseña</mat-label>
    <input matInput 
           [type]="showNewPassword ? 'text' : 'password'" 
           formControlName="newPassword"
           [class.error]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
    <button mat-icon-button 
            matSuffix 
            type="button" 
            (click)="togglePasswordVisibility('new')"
            [attr.aria-label]="'Hide password'" 
            [attr.aria-pressed]="showNewPassword">
      <mat-icon>{{ showNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
    </button>
    <mat-error *ngIf="getFieldError('newPassword')">
      {{ getFieldError('newPassword') }}
    </mat-error>
  </mat-form-field>

  <!-- Confirmar nueva contraseña -->
  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Confirmar nueva contraseña</mat-label>
    <input matInput 
           [type]="showConfirmPassword ? 'text' : 'password'" 
           formControlName="confirmPassword"
           [class.error]="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched">
    <button mat-icon-button 
            matSuffix 
            type="button" 
            (click)="togglePasswordVisibility('confirm')"
            [attr.aria-label]="'Hide password'" 
            [attr.aria-pressed]="showConfirmPassword">
      <mat-icon>{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
    </button>
    <mat-error *ngIf="getFieldError('confirmPassword')">
      {{ getFieldError('confirmPassword') }}
    </mat-error>
  </mat-form-field>

  <!-- Mensaje informativo -->
  <p class="info-text">
    Por tu seguridad, asegúrate de usar una contraseña fuerte con al menos 6 caracteres.
  </p>

</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()" [disabled]="isLoading">
    Cancelar
  </button>
  <button mat-raised-button 
          color="primary" 
          (click)="onSave()" 
          [disabled]="passwordForm.invalid || isLoading">
    <span *ngIf="!isLoading">Guardar</span>
    <span *ngIf="isLoading">Guardando...</span>
  </button>
</mat-dialog-actions>