<div class="container-fluid dashboard-container my-4">
  <!-- Header con gradiente -->
  <div class="dashboard-header mb-5">
    <div class="header-content">
      <h1 class="dashboard-title">Panel de Control Integral</h1>
      <p class="dashboard-subtitle">
        An√°lisis en tiempo real de emisi√≥n de carnets y gesti√≥n organizacional
      </p>
    </div>
    <div class="header-decoration"></div>
  </div>

  <!-- KPIs Principales con iconos y efectos -->
  <div class="row g-4 mb-5">
    <div class="col-md-4">
      <div class="kpi-card kpi-primary">
        <div class="kpi-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="16" rx="2"/>
            <path d="M7 8h10M7 12h10M7 16h6"/>
          </svg>
        </div>
        <div class="kpi-content">
          <p class="kpi-label">Carnets Emitidos</p>
          <h2 class="kpi-value">{{ totalCards }}</h2>
          <span class="kpi-trend trend-up">{{totalCardsCondigurations}} cargas masivas</span>
        </div>
        <div class="kpi-sparkline"></div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="kpi-card kpi-warning">
        <div class="kpi-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 11l3 3L22 4"/>
            <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
          </svg>
        </div>
        <div class="kpi-content">
          <p class="kpi-label">Solicitudes Pendientes</p>
          <h2 class="kpi-value">35</h2>
          <span class="kpi-trend trend-neutral">Requieren atenci√≥n</span>
        </div>
        <div class="kpi-sparkline"></div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="kpi-card kpi-success">
        <div class="kpi-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
        </div>
        <div class="kpi-content">
          <p class="kpi-label">Pr√≥ximos Eventos</p>
          <h2 class="kpi-value">{{ nextEvents }}</h2>
          <span class="kpi-trend trend-up">5 eventos esta semana</span>
        </div>
        <div class="kpi-sparkline"></div>
      </div>
    </div>
  </div>

  <!-- Gr√°ficos principales mejorados -->
  <div class="row g-4 mb-4">
    <!-- Carnets por Unidad con dise√±o mejorado -->
    <div class="col-lg-6">
      <div class="chart-card modern-card">
        <div class="chart-header">
          <div>
            <h5 class="chart-title">Distribuci√≥n por Unidad Organizativa</h5>
            <p class="chart-subtitle">Total: <strong>{{ totalCards }}</strong> carnets emitidos</p>
          </div>
          <div class="chart-actions">
            <!-- <button class="btn-chart-action" title="Exportar">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
              </svg>
            </button> -->
          </div>
        </div>
        <div class="chart-body">
          <canvas baseChart
            [data]="unitOrgChartData"
            [options]="smallBarChartOptions"
            [type]="'bar'"
            (chartClick)="onUnitClick($event)">
          </canvas>
        </div>
        <div class="chart-footer">
          <small class="text-info">üí° Haz clic en una barra para ver divisiones internas</small>
        </div>
      </div>
    </div>

    <!-- Carnets por Jornada con indicadores -->
    <div class="col-lg-6">
      <div class="chart-card modern-card">
        <div class="chart-header">
          <div>
            <h5 class="chart-title">Distribuci√≥n por Jornada Laboral</h5>
            <p class="chart-subtitle">An√°lisis comparativo de horarios</p>
          </div>
          <div class="chart-actions">
            <!-- <button class="btn-chart-action" title="Filtrar">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
              </svg>
            </button> -->
          </div>
        </div>
        <div class="chart-body">
          <canvas baseChart
            [data]="shiftChartData"
            [options]="smallBarChartOptions"
            [type]="'bar'">
          </canvas>
        </div>
        <div class="chart-footer">
          <div class="legend-horizontal">
            <span class="legend-item">
              <span class="legend-color" style="background: #198754;"></span>
              Jornadas activas
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Divisiones Internas (aparece al hacer clic) -->
  <div class="row g-4 mb-4" *ngIf="divisionRawData.length > 0">
    <div class="col-12">
      <div class="chart-card modern-card highlight-card">
        <div class="chart-header">
          <div>
            <h5 class="chart-title">
              <span class="badge-pill">Detalle</span>
              Carnets por Divisiones Internas
            </h5>
            <p class="chart-subtitle">Desglose organizacional espec√≠fico</p>
          </div>
        </div>
        <div class="chart-body">
          <canvas baseChart
            [data]="divisionChartData"
            [options]="smallBarChartOptions"
            [type]="'bar'">
          </canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Secci√≥n inferior: Tipos de Eventos y Notificaciones -->
  <div class="row g-4">
    <!-- Tipos de Evento con drill-down (MODIFICADO) -->
    <div class="col-lg-8">
      <div class="chart-card modern-card events-card">
        <div class="chart-header">
          <div>
            <h5 class="chart-title">Distribuci√≥n por Tipos de Evento</h5>
            <p class="chart-subtitle">Tipos de eventos m√°s utilizados</p>
          </div>
          <div class="event-metrics">
            <div class="metric-badge metric-success">
              <span class="metric-value">{{ (eventTypesRawData || []).length }}</span>
              <span class="metric-label">Tipos</span>
            </div>
            <div class="metric-badge metric-trend">
              <span class="trend-indicator">‚Üë Eventos activos</span>
            </div>
          </div>
        </div>
        <div class="chart-body events-body" style="height: 500px;">
          <canvas
            baseChart
            [data]="eventTypesChartData"
            [options]="nonResponsiveHorizontalBarChartOptions"
            [type]="'bar'"
            style="width: 90%; height: 90%;"
            (chartClick)="onEventTypeClick($event)">
          </canvas>
        </div>
        <div class="chart-footer">
          <div class="event-summary">
            <div class="summary-item">
              <span class="summary-dot dot-high"></span>
              <span>Haz clic en una barra para ver eventos con m√°s asistencia</span>
            </div>
          </div>
        </div>

        <!-- ‚úÖ SOLUCI√ìN: Detalle de Top Eventos DENTRO de la misma card -->
        <div class="top-attendance-container" *ngIf="(eventTopAttendanceRawData || []).length > 0">
          <div class="divider-section">
            <span class="divider-text">Desglose Detallado</span>
          </div>
          <div class="chart-header mt-4">
            <div>
              <h5 class="chart-title">
                <span class="badge-pill">Top 5</span>
                Eventos con Mayor Asistencia
              </h5>
              <p class="chart-subtitle">Por tipo seleccionado</p>
            </div>
          </div>
          <div class="chart-body mt-3" style="height: 280px;">
            <canvas
              baseChart
              [data]="eventTopAttendanceChartData"
              [options]="smallBarChartOptions"
              [type]="'bar'">
            </canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Notificaciones Mejoradas -->
    <div class="col-lg-4">
      <div class="chart-card modern-card notifications-card">
        <div class="chart-header">
          <h5 class="chart-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
              <path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/>
              <path d="M13.73 21a2 2 0 01-3.46 0"/>
            </svg>
            Actividad Reciente
          </h5>
          <span class="notification-badge">3</span>
        </div>
        <div class="notifications-body">
          <ul class="notifications-list">
            <li *ngFor="let notif of notifications" class="notification-item">
              <div class="notification-avatar">
                <img [src]="notif.avatar" alt="avatar" />
                <span class="notification-status status-active"></span>
              </div>
              <div class="notification-content">
                <p class="notification-name">{{ notif.name }}</p>
                <p class="notification-message">{{ notif.message }}</p>
                <span class="notification-time">Hace 5 minutos</span>
              </div>
              <button class="notification-action">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 18 15 12 9 6"/>
                </svg>
              </button>
            </li>
          </ul>
        </div>
        <div class="chart-footer">
          <button mat-raised-button class="btn-view-all">
            Ver todas las notificaciones
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="5" y1="12" x2="19" y2="12"/>
              <polyline points="12 5 19 12 12 19"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer informativo -->
  <div class="dashboard-footer mt-5">
    <p class="text-center text-muted">
      <small>√öltima actualizaci√≥n: {{ currentDate | date:'short' }} | Datos en tiempo real</small>
    </p>
  </div>
</div>